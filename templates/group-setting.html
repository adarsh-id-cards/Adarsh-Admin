{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Group Settings - Adarsh ID Cards</title>
  <link rel="icon" type="image/x-icon" href="{% static 'assets/favicon.ico' %}">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@300;400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{% static 'css/variables.css' %}?v=1">
  <link rel="stylesheet" href="{% static 'css/style.css' %}?v=36">
  <link rel="stylesheet" href="{% static 'css/common.css' %}?v=43">
  <link rel="stylesheet" href="{% static 'css/group-setting.css' %}?v=36">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <!-- SheetJS for Excel export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body class="group-setting-page">

  {% include 'partials/sidebar.html' %}

  <!-- Main -->
  <main class="main">

    <!-- Top Navbar -->
    <header class="topbar">
      <div class="nav-left">
        <button class="sidebar-toggle" id="sidebarToggle">
          <i class="fa-solid fa-bars"></i>
        </button>
        <div class="breadcrumb">
            <a href="{% url 'dashboard' %}" class="breadcrumb-item"><i class="fa-solid fa-house"></i> Home</a>
            <i class="fa-solid fa-chevron-right breadcrumb-sep"></i>
            <a href="{% url 'active_clients' %}" class="breadcrumb-item">Active Clients</a>
            <i class="fa-solid fa-chevron-right breadcrumb-sep"></i>
            {% if client %}
            <span class="breadcrumb-item active">{{ client.name }} - Group Settings</span>
            {% else %}
            <span class="breadcrumb-item active">Group Settings</span>
            {% endif %}
        </div>
      </div>

      <!-- Right - Page Switch Buttons -->
      <div class="nav-right">
        <div class="page-switch-btns">
          {% if client %}
          <a href="{% url 'idcard_group' client.id %}" class="switch-btn" title="ID Card Group">
            <i class="fa-solid fa-id-card"></i> <span>ID Card Group</span>
          </a>
          {% endif %}
          <a href="#" class="switch-btn active" title="Group Setting">
            <i class="fa-solid fa-table-list"></i> <span>Group Setting</span>
          </a>
        </div>
      </div>
    </header>

    <div class="main-content">

      <!-- Add/Edit Drawer Modal -->
      <div id="add-drawer" class="drawer-modal">
        <div class="drawer-content">
          <div class="drawer-header">
            <h3><i class="fa-solid fa-table-list" id="drawerIcon"></i> <span id="drawerTitle">Create New Group Table</span></h3>
            <button class="drawer-close" id="closeDrawer"><i class="fa-solid fa-xmark"></i></button>
          </div>
          <div class="drawer-body">
            <div class="form-group">
              <label for="tableName">Table Name <span class="required">*</span></label>
              <input type="text" id="tableName" class="form-input" placeholder="Enter table name" required>
            </div>
            <div class="field-list-section">
              <label class="field-list-label">Table Fields <span class="field-count">(<span id="fieldCount">0</span>/20)</span></label>
              <div class="field-list-hint">Add up to 20 fields. Drag to reorder. Click remove to delete.</div>
              <ul id="field-list" class="field-list">
                <!-- Fields will be dynamically added here -->
              </ul>
              <div id="no-fields-message" class="no-fields-message">
                <i class="fa-solid fa-info-circle"></i> No fields added yet. Use the form below to add fields.
              </div>
            </div>
            <div class="add-field-section">
              <label>Add New Field</label>
              <div class="add-field-form">
                <div class="add-field-row">
                  <input type="text" id="new-field-name" class="form-input" placeholder="Field Name (e.g., Student Name)">
                  <select id="new-field-type" class="form-input">
                    <option value="text">Text</option>
                    <option value="number">Number</option>
                    <option value="date">Date</option>
                    <option value="email">Email</option>
                    <option value="image">Image</option>
                    <option value="textarea">Textarea</option>
                  </select>
                  <button id="add-field-btn" class="btn btn-primary"><i class="fa-solid fa-plus"></i> Add</button>
                </div>
              </div>
            </div>
            <div class="drawer-footer">
              <button type="button" class="btn btn-cancel" id="cancelDrawer"><i class="fa-solid fa-xmark"></i> Cancel</button>
              <button type="button" class="btn btn-save" id="saveDrawer"><i class="fa-solid fa-plus"></i> Create</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Status Confirmation Modal -->
      <div id="status-modal" class="modal">
        <div class="modal-content">
          <span class="modal-close" id="modal-close">&times;</span>
          <div class="status-icon" id="modalIcon">
            <i class="fa-solid fa-toggle-on"></i>
          </div>
          <p id="modal-message">Are you sure you want to change the status?</p>
          <p class="warning-text">This action will update the table status.</p>
          <div class="modal-actions">
            <button id="modal-cancel" class="btn btn-cancel">Cancel</button>
            <button id="modal-confirm" class="btn btn-confirm">Yes, Change</button>
          </div>
        </div>
      </div>

      <!-- Delete Confirmation Modal -->
      <div id="delete-modal" class="modal">
        <div class="modal-content">
          <span class="modal-close" id="closeDeleteModal">&times;</span>
          <div class="delete-icon">
            <i class="fa-solid fa-trash"></i>
          </div>
          <p>Are you sure you want to delete <strong id="deleteTableName">this table</strong>?</p>
          <p class="warning-text">This action cannot be undone.</p>
          <div class="modal-actions">
            <button id="cancelDeleteBtn" class="btn btn-cancel">Cancel</button>
            <button id="confirmDeleteBtn" class="btn btn-danger">Delete</button>
          </div>
        </div>
      </div>

      <!-- Toast notification -->
      {% include 'partials/components/toast.html' %}

      <!-- Action Bar -->
      <div class="action-bar">
        
        <!-- Left Section - Filter and Search -->
        <div class="action-left">
          <div class="filter-group">
            <div class="custom-dropdown" id="filterDropdown">
              <button class="dropdown-toggle" id="dropdownToggle" type="button">
                <span id="selectedText">All</span>
                <i class="fa-solid fa-chevron-down"></i>
              </button>
              <div class="dropdown-options" id="dropdownOptions">
                <div class="dropdown-option selected" data-value="all">All</div>
                <div class="dropdown-option" data-value="name">Name</div>
                <div class="dropdown-option" data-value="status">Status</div>
              </div>
            </div>
          </div>
          <div class="search-box">
            <i class="fa-solid fa-magnifying-glass search-icon"></i>
            <input type="text" id="searchInput" placeholder="Search All..." class="search-input">
          </div>
        </div>

        <!-- Right Section - Action Buttons -->
        <div class="action-right">
          <div class="actions">
            <div class="btn-group">
              <button class="btn btn-add" id="addBtn"><i class="fa-solid fa-plus"></i> Add</button>
              <button class="btn btn-edit" id="editBtn" disabled><i class="fa-solid fa-pen"></i> Edit</button>
              <button class="btn btn-view" id="viewBtn" disabled><i class="fa-solid fa-eye"></i> View</button>
            </div>
            <div class="btn-separator"></div>
            <div class="btn-group">
              <button class="btn btn-delete" id="deleteBtn" disabled><i class="fa-solid fa-trash"></i> Delete</button>
              <button id="toggle-status-btn" class="btn btn-active" disabled><i class="fa-solid fa-check"></i> Active</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Table Container -->
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>Name</th>
              <th>Status</th>
              <th>Created At</th>
              <th>Updated At</th>
              <th>Download Sample</th>
            </tr>
          </thead>
          <tbody id="tablesBody">
            {% for table in tables %}
            <tr data-table-id="{{ table.id }}" data-table-status="{% if table.is_active %}active{% else %}inactive{% endif %}" data-table-name="{{ table.name }}" data-table-fields="{{ table.fields|safe }}">
              <td>{{ table.name }}</td>
              <td><span class="status-badge {% if table.is_active %}verified{% else %}pending{% endif %}">{% if table.is_active %}Active{% else %}Inactive{% endif %}</span></td>
              <td>{{ table.created_at|date:"d-M-Y h:i A" }}</td>
              <td>{{ table.updated_at|date:"d-M-Y h:i A" }}</td>
              <td><button class="download-btn" data-table-id="{{ table.id }}"><i class="fa-solid fa-download"></i> Download</button></td>
            </tr>
            {% empty %}
            <tr class="no-data-row">
              <td colspan="5" class="text-center">
                <div class="no-tables">
                  <i class="fa-solid fa-table-list"></i>
                  <h3>No Tables Found</h3>
                  <p>Create your first ID card table to get started</p>
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- Pagination Bar -->
      <div class="pagination-bar">
          <div class="pagination-left">
              <span class="pagination-info">Showing <strong>1-{{ tables|length }}</strong> of <strong>{{ tables|length }}</strong> tables</span>
          </div>
          <div class="pagination-center">
              <button class="pagination-btn" disabled title="First Page"><i class="fa-solid fa-angles-left"></i></button>
              <button class="pagination-btn" disabled title="Previous"><i class="fa-solid fa-chevron-left"></i></button>
              <div class="page-numbers">
                  <button class="page-num active">1</button>
              </div>
              <button class="pagination-btn" disabled title="Next"><i class="fa-solid fa-chevron-right"></i></button>
              <button class="pagination-btn" disabled title="Last Page"><i class="fa-solid fa-angles-right"></i></button>
          </div>
          <div class="pagination-right">
              <label>Rows per page:</label>
              <div class="rows-dropdown" id="rowsDropdown">
                  <button class="dropdown-toggle" type="button">
                      <span>10</span>
                      <i class="fa-solid fa-chevron-down"></i>
                  </button>
                  <div class="dropdown-options">
                      <div class="dropdown-option" data-value="10">10</div>
                      <div class="dropdown-option" data-value="25">25</div>
                      <div class="dropdown-option" data-value="50">50</div>
                      <div class="dropdown-option" data-value="100">100</div>
                  </div>
              </div>
          </div>
      </div>

    </div>
  </main>

  <script>
    const GROUP_ID = {% if group %}{{ group.id }}{% else %}null{% endif %};
  </script>
  <script src="{% static 'js/utils.js' %}?v=1"></script>
  <script src="{% static 'js/script.js' %}?v=39"></script>
  <script src="{% static 'js/group-setting.js' %}?v=14"></script>
</body>
</html>
